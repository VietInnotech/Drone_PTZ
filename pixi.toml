[workspace]
authors = ["lkless <leakless21@gmail.com>"]
channels = ["conda-forge"]
name = "AI_ControL_PTZ"
platforms = ["linux-64"]
version = "0.1.0"

[tasks]
# Core application tasks
main = "bash -c 'export PYTHONPATH=${PYTHONPATH}:src && python3 src/main.py'"
cam = "python3 test_camera_detection.py"

# PTZ Simulation task - set USE_PTZ_SIMULATION=True in config before running
sim-video = { cmd = "bash -c 'export PYTHONPATH=${PYTHONPATH}:src && python3 src/main.py'", description = "Run app with PTZ simulation (configure USE_PTZ_SIMULATION=True and VIDEO_SOURCE in config.py)" }

# Comprehensive test suite
test = "python -m pytest tests/ --cov=. --cov-report=html --cov-report=term-missing --tb=short -v"

# Test coverage analysis
test-coverage = "python scripts/test-coverage.py"

# Code linting and formatting
lint = "python scripts/lint.py"

# Pre-commit validation
pre-commit = { cmd = [
    "git diff --cached --name-only --diff-filter=ACM | grep -E '\\.py$' || echo ''",
    "python -m py_compile *.py tests/*.py 2>/dev/null || exit 1",
    "python -m ruff check --no-fix *.py tests/*.py 2>/dev/null || echo 'Linting check failed'",
    "python -m ruff format --check *.py tests/*.py 2>/dev/null || echo 'Formatting check failed'",
    "git diff --cached --name-only --diff-filter=ACM | xargs grep -l 'print(' | head -5 || echo 'No debug prints'",
    "git diff --cached --name-only --diff-filter=ACM | grep -E '\\.sh$' | xargs -I {} sh -c 'head -n1 {} | grep -q \"#!/bin/bash$\" || echo \"Bad shebang in {}\" ' || echo 'Shebang check complete'"
], description = "Fast pre-commit validation checks for syntax, formatting, and common issues" }

# Development workflow (lint -> test -> coverage)
dev = { depends-on = ["lint", "test", "test-coverage"], description = "Run complete development workflow: linting, tests, and coverage analysis" }

# CI pipeline
ci = "python scripts/ci.py"

# Formatting tasks
format = "python -m ruff format *.py tests/*.py"

# Security tasks
security-bandit = "python -m bandit -r *.py tests/*.py -f txt -o security_report.txt"
security = { depends-on = ["security-bandit"], description = "Run security analysis with bandit" }

# Clean tasks
clean-coverage = "rm -f .coverage coverage.json htmlcov/.coverage && rm -rf htmlcov/"
clean-test = "rm -f .pytest_cache .coverage"
clean = { depends-on = ["clean-coverage", "clean-test"], description = "Clean up test artifacts and coverage reports" }
[dependencies]
python = ">=3.11,<3.12"
opencv = ">=4.11.0,<5"
ultralytics = ">=8.3.147,<9"
pytorch-cpu = ">=2.7.0,<3"
torchvision = ">=0.22.0,<0.23"
torchaudio = ">=2.7.0,<3"
lap = ">=0.5.12,<0.6"
numpy = ">=2.2.6,<3"
loguru = ">=0.7.3,<0.8"
pytest = ">=8.4.0,<9"
pytest-cov = ">=4.1.0,<5"
coverage = ">=7.11.0,<8"
[pypi-dependencies]
onvif-zeep = ">=0.2.12, <0.3"
aiortc = ">=1.13.0, <2"
aiohttp = ">=3.12.12, <4"
requests = ">=2.31.0, <3"
loguru = "*"
pytest = "*"

# Development and quality assurance tools
mypy = ">=1.8.0,<2"
bandit = ">=1.7.0,<2"
safety = ">=3.0.0,<4"
pip-audit = ">=2.7.0,<3"
shellcheck-py = ">=0.10.0,<0.11"
ruff = ">=0.14.2, <0.15"

